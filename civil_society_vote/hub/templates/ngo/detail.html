{% extends 'ngo/base.html' %}
{% load static i18n %}
{% load spurl %}
{% load social_share meta_tags hub_tags %}

{% block meta_tags %}
  {% if ngo.logo %}
    {% with title=ngo.name image=ngo.logo.url %}
      {% meta_tags %}
    {% endwith %}
  {% endif %}
{% endblock %}


{% block left-side-view %}
{% block extra-header %}
{% endblock %}
{% block domain-filters %}
{% endblock%}

<div class="container need is-flex">
    <div class="card-image need-logo is-hidden-mobile">
        {% if ngo.logo %}
        <img src="{{ ngo.logo.url }}" alt="{{ ngo.name }}">
        {% else %}
        <img src="{% static 'images/logo-demo.png' %}" alt="{{ ngo.name }}">
        {% endif %}
    </div>

    <div class="card-info">
        <div class="flex-align-center">
            <div class="card-image need-logo is-hidden-tablet">
                {% if ngo.logo %}
                <img src="{{ ngo.logo.url }}" alt="{{ ngo.name }}">
                {% else %}
                <img src="{% static 'images/logo-demo.png' %}" alt="{{ ngo.name }}">
                {% endif %}
            </div>
            <div class="need-title is-hidden-tablet">{{ ngo.name }}</div>
        </div>
        <div class="need-subtitle is-hidden-mobile">{{ ngo.email }}</div>
        <div class="need-title is-hidden-mobile">{{ ngo.name }}</div>
        <div class="need-subtitle is-hidden-tablet">{{ ngo.email }}</div>
        <div class="need-description">{{ ngo.domain }}</div>
        <div class="need-description"><b>Stare aplica»õie: <span class="status-{{ngo.status}}">{% trans ngo.status.capitalize %}</span></b></div>
    </div>
</div>


<hr/>

<div class="container detail-desc">
    <div class="detail-desc-title">
        <span class="colorblock" style="background-color:#5E72E4;"></span>
        {% trans "About the organization" %}
    </div>
    {% if ngo.description %}
    <p><span class="label">{% trans 'Description' %}:</span> {{ ngo.description }}</p>
    <hr>
    {% endif %}
    <p><span class="label">{% trans 'Founders' %}:</span> {{ ngo.founders }}</p>
    <p><span class="label">{% trans 'Representative' %}:</span> {{ ngo.representative }}</p>
    <p><span class="label">{% trans 'Board council' %}:</span> {{ ngo.board_council }}</p>
    <hr>
    <p><span class="label">{% trans 'Initial purpose' %}:</span> {{ ngo.purpose_initial }}</p>
    <p><span class="label">{% trans 'Current purpose' %}:</span> {{ ngo.purpose_current }}</p>
    <div class="detail-desc-title">
        <span class="colorblock" style="background-color:#5E72E4;"></span>
        {% trans "Documents" %}
    </div>
    <p><a href="{{ ngo.last_balance_sheet.url }}" title="{% trans 'First page of last balance sheet' %}">{% trans 'First page of last balance sheet' %}</a></p>
    <p><a href="{{ ngo.statute.url }}" title="{% trans 'NGO Statute' %}">{% trans 'NGO Statute' %}</a></p>
    <p><a href="{{ ngo.letter.url }}" title="{% trans 'Letter of intent' %}">{% trans 'Letter of intent' %}</a></p>
</div>

{% if ORG_VOTING_ENABLED and user|in_committee_group and ngo.status == 'pending' %}
{% user_org_vote_obj user ngo as user_vote%}

<hr>

<div class="container detail-desc">
  {% if user|already_voted_org:ngo %}
  <article id="vote-org-info" class="message is-info">
    <div class="message-body">Ati votat deja pentru aceasta organizatie.</div>
  </article>
  {% else %}
  <article id="vote-org-error" class="message is-danger" style="display: none;">
    <div class="message-body">A avut loc o eroare in momentul votarii. Cel mai probabil ati votat deja pentru aceasta organizatie. <br> Daca credeti ca aceasta eroare este o greseala va rugam sa ne contactati utilizand <a href="{% url 'contact' %}">formularul de contact<a>.</div>
  </article>

  <article id="vote-org-success" class="message is-success" style="display: none;">
    <div class="message-body">Votul a fost inregistrat cu succes.</div>
  </article>
  {% endif %}

  {% if user|already_voted_org:ngo %}
  {% if user_vote.motivation %}
  <b>Motivatie:</b> {{ user_vote.motivation }}
  {% endif %}
  {% else %}
  <textarea id="vote-org-motivation" name="motivation" class="textarea" placeholder="Motivatia votului (obligatoriu daca votul este NU)"></textarea>
  {% endif %}

  <div class="buttons vote-org-buttons">
    <button class="button is-danger is-large vote-org-button" id="no" {% if user|already_voted_org:ngo %}disabled{% endif %}>NU</button>
    <button class="button is-success is-large vote-org-button" id="yes" {% if user|already_voted_org:ngo %}disabled{% endif %}>DA</button>
    <button class="button is-warning is-large vote-org-button" id="abstention" {% if user|already_voted_org:ngo %}disabled{% endif %}>ABTINERE</button>
  </div>
</div>

{% if user|already_voted_org:ngo %}
<script>
$( document ).ready(function() {
  $( ".vote-org-button" ).removeClass( "is-large" ).addClass( "is-small" );
  $( "#{{ user_vote.vote }}" ).addClass( "is-large" )
});
</script>
{% else %}
<script>
$( document ).ready(function() {
  $( ".vote-org-button" ).on( "click", function( event ) {
    var button = $( this )
    var vote = $( this ).attr("id");
    var motivation = $( "#vote-org-motivation" ).val();

    if ( vote === "no" && motivation === "" ) {
      alert("Trebuie sa scrieti o motivatie pentru un vot NU!");
    } else {
      $.get( "{% url 'ngo-vote' ngo.id %}", { vote: vote, motivation: motivation }, function() {
        $( ".vote-org-button" ).attr("disabled", true).removeClass( "is-large" ).addClass( "is-small" );
        button.addClass( "is-large" );
        $( "#vote-org-motivation" ).attr("disabled", true);
        $( "#vote-org-success" ).show();
      }).fail(function() {
        $( "#vote-org-error" ).show();
      });
    }

    return false;
  });
});
</script>
{% endif %}

{% endif %}

{% comment %}
{% social_buttons obj=ngo %}
{% endcomment %}

{% endblock %}

{% block content %}
{% url "ngos" as ngos %}
{% with current_url=ngos %}
{{ block.super }}
{% endwith %}
{% endblock %}
